<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sailpoint PUBLIC "sailpoint.dtd" "sailpoint.dtd">
<sailpoint>
<Rule language="beanshell" name="Ps_converted_id_onlyconverts">
  <Source>
           
import org.apache.log4j.Logger;
    import java.io.File;
    import java.util.ArrayList;
    import java.util.List;
    import java.util.Scanner;
  	import sailpoint.object.nameOptions;
		import sailpoint.object.*;
  	import sailpoint.object.Identity;
  	
  	List names = new ArrayList();
  	try {
     
      //String filename = "C:\\Program Files\\Apache Software Foundation\\Tomcat 9.0\\ApplicationFiles\\Certification\\managers_with_pending_reviews.csv";
      //Use to send certification initiation names to managers for whom access reviews are created
      String filename = "C:\\Program Files\\Apache Software Foundation\\Tomcat 9.0\\logs\\id.txt";
     
			Scanner sc = new Scanner(new File(filename));
			sc.useDelimiter("\r\n");
			while (sc.hasNext()) {
				String name = (String) sc.next();
       
				names.add(name);
			}
			sc.close();
     
		} catch (Exception e) {
			// TODO: handle exception
      log.error(e.getMessage());
		}
  	
		try {

			for (Object obj1 : names) {
				String name = (String)obj1;
        
				Identity id = context.getObjectByName(Identity.class, name);
        
				if (id != null) {
				
				List links=id.getLinks();
				String idName=id.getName();
          String idmail=id.getAttribute("email");
				for(Link ln :links)
				{
				String ApplicationName=ln.getApplicationName();
				
				if(ApplicationName.equalsIgnoreCase("Active Directory"))
				
				{
				if(!ln.getIiqDisabled()) 
				
		
				
				{
				
 FileWriter writer=new FileWriter("C:\\Program Files\\Apache Software Foundation\\Tomcat 9.0\\logs\\file.txt",true);
   
    
   
   
  		writer.write(idmail);
  
  writer.write("\n");
  
    

  writer.close(); 
				
				}
				
				}
				}
					
				}
			}
    
		} catch (Exception e) {
			// TODO: handle exception
      log.error(e.getMessage());
		}
  	
       
</Source>
</Rule>

</sailpoint>