<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sailpoint PUBLIC "sailpoint.dtd" "sailpoint.dtd">
<sailpoint>
<Rule language="beanshell" name="Route-test">
  <Source>
 import java.text.MessageFormat;

import javax.inject.Inject;

import java.io.IOException;

import java.util.*;

import org.apache.commons.logging.Log;

import org.apache.commons.logging.LogFactory;

import sailpoint.object.*;

import sailpoint.web.UserContext;

import sailpoint.api.*;

import sailpoint.messaging.MessageResult;

import sailpoint.messaging.MessagingServiceProvider;

import sailpoint.rest.ui.UserResetResource;

import java.util.Scanner;

import org.apache.http.HttpResponse;

import org.apache.http.StatusLine;

import org.apache.http.client.ClientProtocolException;

import org.apache.http.client.methods.HttpGet;

import org.apache.http.impl.client.CloseableHttpClient;

import org.apache.http.impl.client.HttpClients;

import java.io.BufferedReader;

import java.io.DataOutputStream;

import java.io.InputStreamReader;

import java.net.HttpURLConnection;

import java.net.URL;

import java.net.URLEncoder;

import sailpoint.web.LoginBean;

import sailpoint.web.BaseBean;
 
  
  String username=null;

  String password=null;

  String message=null;

  String type=null;

  String dlr=null;

  String destination=null;

  String source=null;

  String server=null;

 // try {

    server="api.rmlconnect.net";

    username="OTPsAMERICA";

    password="D0*j(5Pz";

    destination="+971509246851";

    message="Yourverificationcodeisandwillexpirein10minutes.";

    source="Americana";

    type="0";

    dlr="0";

  log.error("starting code");

    URL sendUrl = new URL("https://api.rmlconnect.net:443/bulksms/bulksms?");
    log.error("2 line");

    HttpURLConnection httpConnection = (HttpURLConnection) sendUrl .openConnection();
 log.error("3 line");

    httpConnection.setRequestMethod("POST");
     log.error("4 line");

    httpConnection.setDoInput(true);
     log.error("5 line");

    httpConnection.setDoOutput(true);
     log.error("6 line");

    httpConnection.setUseCaches(false);
     log.error("7 line");
    DataOutputStream dataStreamToServer=null;

    dataStreamToServer = new DataOutputStream(httpConnection.getOutputStream());
    log.error("entered parse");

    dataStreamToServer.writeBytes("username="+ URLEncoder.encode(username, "UTF-8") +"&amp;password="+ URLEncoder.encode(password, "UTF-8") +"&amp;message="+ URLEncoder.encode(message, "UTF-8")+"&amp;type="+ URLEncoder.encode(type, "UTF-8") +"&amp;dlr="+ URLEncoder.encode(dlr, "UTF-8")  + "&amp;destination="+ URLEncoder.encode(destination, "UTF-8") + "&amp;source="+ URLEncoder.encode(source, "UTF-8") );
    dataStreamToServer.flush();

    dataStreamToServer.close();

    BufferedReader dataStreamFromUrl = new BufferedReader(new InputStreamReader(httpConnection.getInputStream()));

    String dataFromUrl = "", dataBuffer = "";

    while ((dataBuffer =dataStreamFromUrl.readLine()) != null) {

      dataFromUrl += dataBuffer;

    }

    dataStreamFromUrl.close();

   

    if(dataFromUrl.contains("1701")||dataFromUrl.contains(destination)) {

     return dataFromUrl;

    }



   

  /*} catch (Exception e) {


    log.error("TwilioServiceProvider custom, sendMessage(), error: " + e.getMessage(), e);

  }*/



  



  



  </Source>
</Rule>

</sailpoint>