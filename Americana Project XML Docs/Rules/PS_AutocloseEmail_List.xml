<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sailpoint PUBLIC "sailpoint.dtd" "sailpoint.dtd">
<sailpoint>
<Rule language="beanshell" name="PS_AutocloseEmail_List">
  <Source>
  	import sailpoint.object.Certification;
  import sailpoint.object.Filter;
  import sailpoint.object.QueryOptions;
  import java.util.Iterator;
  import sailpoint.object.Identity;
  import java.util.List;
  import java.util.ArrayList;
  import sailpoint.object.CertificationEntity;
  import sailpoint.object.CertificationAction;
  import sailpoint.api.Certificationer;
  import sailpoint.tools.Message;
  import sailpoint.tools.Message.Type;
  import sailpoint.object.TaskResult;
  
  import org.apache.log4j.Logger;


  Logger log=Logger.getLogger("customRule4");

  
 
  Filter certGroupFilter = Filter.eq("certificationGroups.id","0a0805848cb619d6818cb6e663f40096");
 
  QueryOptions qo = new QueryOptions();
  qo.addFilter(certGroupFilter);

                     
  Iterator iterator = context.search(Certification.class,qo);
   while(iterator.hasNext()){
  	Certification certification = (Certification)iterator.next();
     
     
     
     
     
     
     
     
     
     	List signoff=certification.getSignOffs();
				
				if(signoff.isEmpty())
				{
	 List certifiers = certification.getCertifiers();
 if(!certifiers.isEmpty()&amp;&amp; certifiers.size()==1) {
	  Identity certifier = context.getObjectByName(Identity.class,certifiers.get(0).toString());
	  if(certifier!=null) {
	  String certifierEmail=(String) certifier.getAttribute("email");
	  //log.error("certifierEmail: "+certifierEmail);
	  String certifierName=certifier.getName();
       String certifierFirstName=certifier.getFirstname();
       String certifierSecondName=certifier.getLastname();
    
	  //log.error("certifierName "+certifierName);
	  String certifierDisplayName=certifier.getDisplayName();
	  //log.error("certifierDisplayName "+certifierDisplayName);
				//	log.error("send email");


	if(certifierEmail!=null)
	{


	log.error(" send email to mangeremail ::::::::  "+certifierEmail); 
			/*	String templateName = "ps_Autoclosing";


		 EmailTemplate template = (EmailTemplate) context.getObject(EmailTemplate.class, templateName); 
		  template.setTo(certifierEmail);
		 
		EmailOptions options = new EmailOptions();
		 
		options.setVariable("manager", certifierName);
    options.setVariable("managerFirstName", certifierFirstName);
    options.setVariable("managerSecondName", certifierSecondName);
		// options.setVariable("identityMap", certifierEmail); 

		//context.sendEmailNotification(template, options);

	}*/
				}
else{
//log.error("certifier object is null");
}
}
}
     
     
     
     
     
   }
   }
  
  
  </Source>
</Rule>

</sailpoint>