<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sailpoint PUBLIC "sailpoint.dtd" "sailpoint.dtd">
<sailpoint>
<Form name="Americana_ContractorAdditionalAccess_Approval_Form" type="Workflow">
  <Attributes>
    <Map>
      <entry key="pageTitle" value="Contractor Additional Access Request - Manager Approval form" />
    </Map>
  </Attributes>
  <Section columns="2" label="Selected Contractor Details for additional access request">
    <Field columnSpan="2" displayName="Selected Contractor" name="user" readOnly="true" required="true" type="String" />
  </Section>
  <Section columns="2" type="datatable">
    <Field columnSpan="1" displayName="sAMAccountName" name="sAMAccountName" readOnly="true" type="String" />
    <Field columnSpan="1" displayName="First name" name="firstname" readOnly="true" type="String" />
    <Field columnSpan="1" displayName="Last name" name="lastname" readOnly="true" type="String" />
    <Field columnSpan="1" displayName="Job Title" name="jobTitle" readOnly="true" type="String" />
    <Field columnSpan="1" displayName="Department" name="department" readOnly="true" type="String" />
    <Field columnSpan="1" displayName="Manager" name="manager" readOnly="true" type="String" />
  </Section>
  <Section columns="2" label="selected access">
    <Field columnSpan="1" displayName="VPN Access" displayType="radio" name="vpn" readOnly="true" type="boolean" />
    <Field columnSpan="1" displayName="Email Access" displayType="radio" name="email" readOnly="true" type="boolean" />
    <Field columnSpan="1" displayName="Laptop" displayType="radio" name="laptop" readOnly="true" type="boolean" />
    <Field columnSpan="1" displayName="Onsite Access Required" displayType="radio" name="wifiaccess" readOnly="true" type="boolean" />
    <Field columnSpan="1" displayName="VpnServers" displayType="comboBox" multi="true" name="vpnServer" readOnly="true" type="string">
      <Attributes>
        <Map>
          <entry key="hidden">
            <value>
              <Script>
                <Source>
                  boolean hidden = true;
									String vpnValue = "";
                  Object vpnObject=form.getField("vpn").getValue();
                  if(null != vpnObject){
                  	vpnValue = String.valueOf(vpnObject);
                  	if(null != vpnValue @and !"".equalsIgnoreCase(vpnValue) @and "true".equalsIgnoreCase(vpnValue)){
                  		hidden = false;
                  	}
                  }
                  
                  return hidden;
                </Source>
              </Script>
            </value>
          </entry>
        </Map>
      </Attributes>
    </Field>
  </Section>
  <Section>
    <Field columnSpan="1" displayName="Business Justification" displayType="combobox" name="justification" postBack="true" readOnly="true" required="true" type="string">
      <AllowedValues>
        <String>Requesting additional access for the existing contractor</String>
        <String>Other</String>
      </AllowedValues>
    </Field>
    <Field columnSpan="1" displayName="Justificatiion Reason" displayType="textarea" dynamic="true" name="otherJustificationReason" readOnly="true" required="true" type="string">
      <Attributes>
        <Map>
          <entry key="hidden">
            <value>
              <Script>
                <Source>
                  boolean hideField = true;
                  if(null != form.getField("justification").getValue() @and "Other".equalsIgnoreCase(form.getField("justification").getValue())){
                  	hideField = false;
                  }
                  
                  return hideField;
                </Source>
              </Script>
            </value>
          </entry>
        </Map>
      </Attributes>
      <ValidationScript>
        <Source>
// empty messages list

import sailpoint.tools.Message;   

List messages = new ArrayList();
          int requiredlength = 50;
          

if(null != value &amp;&amp; value.length() &lt; 50){          	
	Message message = new Message();
	message.setKey("Please ensure that the minimum length is 50 characters, remaining characters "+(requiredlength-value.length())+"/50");
	messages.add(message);
}
return messages;          
          
        </Source>
      </ValidationScript>
    </Field>
  </Section>
  <Section label="Attachment Details" name="attachment section" type="datatable">
    <Attributes>
      <Map>
        <entry key="hidden">
          <value>
            <Script>
              <Source>
              if(null != fileParameters @and void != fileParameters){
              return false;
              }
              
              return true;
              </Source>
            </Script>
          </value>
        </entry>
        <entry key="subtitle" value="Below are the attachment details submitted by the requestor" />
      </Map>
    </Attributes>
    <Field helpKey="Please click on the link to check the approval document">
      <Attributes>
        <Map>
          <entry key="contentIsEscaped" value="true" />
        </Map>
      </Attributes>
      <RuleRef>
        <Reference class="sailpoint.object.Rule" name="Americana-ContractorForms-DynamicTable-FieldValue" />
      </RuleRef>
    </Field>
  </Section>
  <Section label="Approval Status" name="Approval Status" type="datatable">
    <Field helpKey="Please find Approval Status">
      <Attributes>
        <Map>
          <entry key="contentIsEscaped" value="true" />
        </Map>
      </Attributes>
      <RuleRef>
        <Reference class="sailpoint.object.Rule" name="ps-approvalStatus-FieldValue" />
      </RuleRef>
    </Field>
  </Section>
  <Button action="next" label="Approve" value="Approve" />
  <Button action="back" label="Reject" value="Reject" />
  <Button action="cancel" label="nav_cancel" />
</Form>

</sailpoint>